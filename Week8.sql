use mysql;
create user poorvi identified by "1BM24CS204";
grant all privileges on *.* to "poorvi";
flush privileges;
CREATE DATABASE SupplierParts;
USE SupplierParts;
CREATE TABLE SUPPLIERS (
    SID INT PRIMARY KEY,
    SNAME VARCHAR(50),
    CITY VARCHAR(50)
);
INSERT INTO SUPPLIERS (SID, SNAME, CITY) VALUES
(10001, 'Acme Widget', 'Bangalore'),
(10002, 'Johns', 'Kolkata'),
(10003, 'Vimal', 'Mumbai'),
(10004, 'Reliance', 'Delhi');

CREATE TABLE PARTS (
    PID INT PRIMARY KEY,
    PNAME VARCHAR(50),
    COLOR VARCHAR(20)
);
INSERT INTO PARTS (PID, PNAME, COLOR) VALUES
(20001, 'Book', 'Red'),
(20002, 'Pen', 'Red'),
(20003, 'Pencil', 'Green'),
(20004, 'Mobile', 'Green'),
(20005, 'Charger', 'Black');
CREATE TABLE CATALOG (
    SID INT,
    PID INT,
    COST INT,
    PRIMARY KEY (SID, PID),
    FOREIGN KEY (SID) REFERENCES SUPPLIERS(SID),
    FOREIGN KEY (PID) REFERENCES PARTS(PID)
);
INSERT INTO CATALOG (SID, PID, COST) VALUES
(10001, 20001, 10),
(10001, 20002, 10),
(10001, 20003, 30),
(10001, 20004, 10),
(10001, 20005, 10),
(10002, 20001, 10),
(10002, 20002, 20),
(10003, 20003, 30),
(10004, 20003, 40);
SELECT s.SID, s.SNAME, p.PID, p.PNAME, c.COST
FROM CATALOG c
JOIN SUPPLIERS s ON c.SID = s.SID
JOIN PARTS p ON c.PID = p.PID
WHERE c.COST = (SELECT MAX(COST) FROM CATALOG);
SELECT s.SID, s.SNAME
FROM SUPPLIERS s
WHERE s.SID NOT IN (
    SELECT c.SID
    FROM CATALOG c
    JOIN PARTS p ON c.PID = p.PID
    WHERE p.COLOR = 'Red'
);
SELECT s.SID, s.SNAME, SUM(c.COST) AS TOTAL_VALUE
FROM SUPPLIERS s
LEFT JOIN CATALOG c ON s.SID = c.SID
GROUP BY s.SID, s.SNAME;
SELECT s.SID, s.SNAME
FROM SUPPLIERS s
JOIN CATALOG c ON s.SID = c.SID
WHERE c.COST < 20
GROUP BY s.SID, s.SNAME
HAVING COUNT(*) >= 2;
SELECT c.SID, s.SNAME, c.PID, p.PNAME, c.COST
FROM CATALOG c
JOIN SUPPLIERS s ON c.SID = s.SID
JOIN PARTS p ON c.PID = p.PID
WHERE c.COST = (
    SELECT MIN(COST)
    FROM CATALOG c2
    WHERE c2.PID = c.PID
);
CREATE VIEW Supplier_PartCount AS
SELECT s.SID, s.SNAME, COUNT(c.PID) AS TOTAL_PARTS
FROM SUPPLIERS s
LEFT JOIN CATALOG c ON s.SID = c.SID
GROUP BY s.SID, s.SNAME;
CREATE VIEW MostExpensiveSupplier AS
SELECT c.SID, s.SNAME, c.PID, p.PNAME, c.COST
FROM CATALOG c
JOIN SUPPLIERS s ON c.SID = s.SID
JOIN PARTS p ON c.PID = p.PID
WHERE c.COST = (
    SELECT MAX(COST)
    FROM CATALOG c2
    WHERE c2.PID = c.PID
);
DELIMITER $$
CREATE TRIGGER Check_Cost_Min
BEFORE INSERT ON CATALOG
FOR EACH ROW
BEGIN
    IF NEW.COST < 1 THEN
        SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'Cost must be at least 1';
    END IF;
END$$
DELIMITER ;

DELIMITER $$
CREATE TRIGGER Set_Default_Cost
BEFORE INSERT ON CATALOG
FOR EACH ROW
BEGIN
    IF NEW.COST IS NULL THEN
        SET NEW.COST = 10;
    END IF;
END$$
DELIMITER ;